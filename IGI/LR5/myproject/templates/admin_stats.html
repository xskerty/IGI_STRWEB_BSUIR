{% extends 'base.html' %}

{% block content %}
<h1>üìä –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>

<h2>1. üìç –ó–∞–∫–∞–∑—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>–ì–æ—Ä–æ–¥</th>
        <th>–ö–æ–ª-–≤–æ –∑–∞–∫–∞–∑–æ–≤</th>
        <th>–°—É–º–º–∞ (BYN)</th>
        <th>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</th>
    </tr>
    {% for item in orders_by_city %}
    <tr>
        <td>{{ item.city }}</td>
        <td>{{ item.count }}</td>
        <td>{{ item.total|floatformat:2 }}</td>
        <td>{{ item.avg|floatformat:2 }}</td>
    </tr>
    {% endfor %}
</table>

<h2>2. üèÜ –¢–æ–ø-10 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ü—Ä–æ–¥–∞–Ω–æ</th>
        <th>–í—ã—Ä—É—á–∫–∞ (BYN)</th>
    </tr>
    {% for product in top_products %}
    <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.sold|default:"0" }}</td>
        <td>{{ product.revenue|default:"0"|floatformat:2 }}</td>
    </tr>
    {% endfor %}
</table>

<h2>3. ‚ùå –¢–æ–≤–∞—Ä—ã –±–µ–∑ –ø—Ä–æ–¥–∞–∂</h2>
<ul>
    {% for product in unsold_products %}
        <li>{{ product.name }}</li>
    {% empty %}
        <li>–í—Å–µ —Ç–æ–≤–∞—Ä—ã –±—ã–ª–∏ –ø—Ä–æ–¥–∞–Ω—ã</li>
    {% endfor %}
</ul>

<h2>4. üóìÔ∏è –ì–æ–¥–æ–≤–æ–π –æ—Ç—á–µ—Ç –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>–ú–µ—Å—è—Ü</th>
        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤</th>
        <th>–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ (BYN)</th>
    </tr>
    {% for item in monthly_income %}
    <tr>
        <td>{{ item.month }}</td>
        <td>{{ item.count }}</td>
        <td>{{ item.total|floatformat:2 }}</td>
    </tr>
    {% endfor %}
</table>

<h2>5. üë• –¢–æ–ø-10 –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
        <th>–ì–æ—Ä–æ–¥</th>
        <th>–ö–æ–ª-–≤–æ –∑–∞–∫–∞–∑–æ–≤</th>
        <th>–°—É–º–º–∞ (BYN)</th>
    </tr>
    {% for client in income_by_customer %}
    <tr>
        <td>{{ client.customer__user__username }}</td>
        <td>{{ client.customer__city }}</td>
        <td>{{ client.count }}</td>
        <td>{{ client.total|floatformat:2 }}</td>
    </tr>
    {% endfor %}
</table>

<h3>üìâ –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º</h3>
{% if chart_customer %}
    <img src="/media/{{ chart_customer }}" alt="–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º" width="600" style="display: block; border: 1px solid red;">
{% else %}
    <p>–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
{% endif %}

<h2>6. üßº –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
        <th>–ü—Ä–æ–¥–∞–Ω–æ (—à—Ç)</th>
        <th>–í—ã—Ä—É—á–∫–∞ (BYN)</th>
    </tr>
    {% for row in product_summary %}
    <tr>
        <td>{{ row.product_type__name }}</td>
        <td>{{ row.total_sold|default:"0" }}</td>
        <td>{{ row.revenue|default:"0"|floatformat:2 }}</td>
    </tr>
    {% endfor %}
</table>

<h3>üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
{% if chart_categories %}
    <img src="/media/{{ chart_categories }}" alt="–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º" width="600" style="display: block; border: 1px solid red;">
{% else %}
    <p>–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
{% endif %}

<h2>7. üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂</h2>
{% if forecast_data %}
    <p>
        –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü: <strong>{{ forecast_data.value }} BYN</strong><br>
        –¢—Ä–µ–Ω–¥:
        {% if forecast_data.trend == 'up' %}
            üìà –†–æ—Å—Ç (+{{ forecast_data.change }}%)
        {% else %}
            üìâ –ü–∞–¥–µ–Ω–∏–µ ({{ forecast_data.change }}%)
        {% endif %}
    </p>
    <h3>üìà –õ–∏–Ω–µ–π–Ω—ã–π —Ç—Ä–µ–Ω–¥ –∏ –ø—Ä–æ–≥–Ω–æ–∑</h3>
    {% if forecast_chart %}
        <img src="/media/{{ forecast_chart }}" alt="–ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂" width="600" style="display: block; border: 1px solid red;">
    {% else %}
        <p>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞.</p>
    {% endif %}
{% else %}
    <p>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞.</p>
{% endif %}
<h2>8. üë• –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑—á–∏–∫–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º</h2>
{% for city, customers in grouped_customers.items %}
    <h3>{{ city }}</h3>
    <table border="1" cellpadding="5">
        <tr>
            <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
            <th>Email</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
        </tr>
        {% for customer in customers %}
        <tr>
            <td>{{ customer.username }}</td>
            <td>{{ customer.email }}</td>
            <td>{{ customer.phone }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3">–ù–µ—Ç –∑–∞–∫–∞–∑—á–∏–∫–æ–≤ –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ</td>
        </tr>
        {% endfor %}
    </table>
{% empty %}
    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑—á–∏–∫–∞—Ö.</p>
{% endfor %}
{% endblock %}